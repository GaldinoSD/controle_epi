{% extends "base.html" %}
{% block content %}

<div class="max-w-7xl mx-auto">

  <!-- ===================== CABEÇALHO ===================== -->
  <div class="flex items-center justify-between mb-8">
    <h2 class="text-3xl font-semibold text-gray-800 flex items-center gap-3">
      <i class="fas fa-user-shield text-blue-600 text-3xl"></i>
      Gerenciamento de Usuários
    </h2>

    <button onclick="abrirModalUsuario()"
      class="bg-blue-600 hover:bg-blue-700 text-white rounded-lg px-6 py-2 font-semibold text-sm shadow transition transform hover:scale-105">
      <i class="fas fa-user-plus mr-2"></i> Novo Usuário
    </button>
  </div>

  <p class="text-gray-600 mb-6">Gerencie os acessos e permissões dos usuários do sistema.</p>

  <!-- ===================== LISTA ===================== -->
  <div class="bg-white border border-gray-200 rounded-xl shadow p-8">

    <h3 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center gap-3">
      <i class="fas fa-users text-blue-600"></i>
      Usuários Cadastrados
    </h3>

    {% if usuarios %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">

      {% for u in usuarios %}
      <div class="bg-gray-50 border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition p-0 overflow-hidden">

        <!-- CARD HEADER -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 p-4 flex items-center">
          <i class="fas fa-user-circle text-4xl text-white mr-3"></i>
          <div>
            <h4 class="text-lg font-semibold text-white">{{ u.nome }}</h4>
            <p class="text-blue-100 text-sm capitalize">{{ u.role }}</p>
          </div>
        </div>

        <!-- CARD BODY -->
        <div class="p-5 text-sm text-gray-700 space-y-4">

          <form method="POST" action="{{ url_for('editar_usuario', id=u.id) }}">

            <!-- LOGIN -->
            <label class="block">
              <span class="text-gray-500 text-xs font-semibold">Login</span>
              <input type="text" name="login" value="{{ u.login }}"
                class="mt-1 bg-white border border-gray-300 rounded-lg px-3 py-2 w-full text-gray-800 focus:ring-2 focus:ring-blue-400 transition text-sm">
            </label>

            <!-- ROLE -->
            <label class="block mt-3">
              <span class="text-gray-500 text-xs font-semibold">Permissão</span>
              <select name="role"
                class="mt-1 bg-white border border-gray-300 rounded-lg px-3 py-2 w-full text-gray-800 focus:ring-2 focus:ring-blue-400 transition text-sm">
                <option value="user" {% if u.role == 'user' %}selected{% endif %}>Usuário</option>
                <option value="supervisor" {% if u.role == 'supervisor' %}selected{% endif %}>Supervisor</option>
                <option value="admin" {% if u.role == 'admin' %}selected{% endif %}>Administrador</option>
              </select>
            </label>

            <!-- BOTÕES -->
            <div class="flex justify-between mt-5">
              <button type="submit"
                class="bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded-lg shadow text-xs font-medium transition flex items-center gap-1">
                <i class="fas fa-save"></i> Salvar
              </button>

              {% if u.login != 'admin' %}
              <a href="{{ url_for('deletar_usuario', id=u.id) }}"
                onclick="return confirm('Deseja realmente excluir este usuário?')"
                class="bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 rounded-lg shadow text-xs font-medium transition flex items-center gap-1">
                <i class="fas fa-trash"></i> Excluir
              </a>
              {% endif %}
            </div>

          </form>

        </div>
      </div>
      {% endfor %}

    </div>

    {% else %}
    <p class="text-gray-500 text-center py-6 italic">Nenhum usuário cadastrado.</p>
    {% endif %}

  </div>
</div>

<!-- ===================== MODAL ===================== -->
<div id="modalUsuario" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-50 backdrop-blur-sm">
  <div class="bg-white border border-gray-200 rounded-xl shadow-xl p-8 w-full max-w-xl animate-fadeIn">

    <div class="flex justify-between items-center mb-6 pb-3 border-b border-gray-200">
      <h3 class="text-2xl font-semibold text-gray-800 flex items-center gap-3">
        <i class="fas fa-user-plus text-blue-600"></i> Novo Usuário
      </h3>
      <button onclick="fecharModalUsuario()" class="text-gray-500 hover:text-red-500 text-xl">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <form method="POST" action="{{ url_for('usuarios') }}" class="grid grid-cols-1 md:grid-cols-2 gap-5">

      <!-- NOME -->
      <div class="md:col-span-2">
        <label class="block text-gray-500 text-sm">Nome completo</label>
        <input type="text" name="nome" required
          class="mt-1 bg-white border border-gray-300 rounded-lg px-4 py-2 w-full text-gray-800 focus:ring-2 focus:ring-blue-400 transition">
      </div>

      <!-- LOGIN -->
      <div>
        <label class="block text-gray-500 text-sm">Login de acesso</label>
        <input type="text" name="login" required
          class="mt-1 bg-white border border-gray-300 rounded-lg px-4 py-2 w-full text-gray-800 focus:ring-2 focus:ring-blue-400 transition">
      </div>

      <!-- SENHA -->
      <div>
        <label class="block text-gray-500 text-sm">Senha</label>
        <div class="relative mt-1">
          <input type="password" id="senha_nova" name="senha" required
            class="bg-white border border-gray-300 rounded-lg px-4 py-2 w-full text-gray-800 focus:ring-2 focus:ring-blue-400 transition">
          <button type="button" onclick="toggleSenha('senha_nova')"
            class="absolute right-3 top-2.5 text-gray-400 hover:text-blue-600">
            <i class="fas fa-eye"></i>
          </button>
        </div>
      </div>

      <!-- ROLE -->
      <div class="md:col-span-2">
        <label class="block text-gray-500 text-sm">Permissão</label>
        <select name="role"
          class="mt-1 bg-white border border-gray-300 rounded-lg px-4 py-2 w-full text-gray-800 focus:ring-2 focus:ring-blue-400 transition">
          <option value="usuario">Usuário</option>
          <option value="estoquista">Estoquista</option>
          <option value="admin">Administrador</option>

        </select>
      </div>

      <!-- BOTÕES -->
      <div class="md:col-span-2 flex justify-end gap-4 mt-6">
        <button type="button" onclick="fecharModalUsuario()"
          class="bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg px-6 py-2 text-sm transition">
          <i class="fas fa-times mr-2"></i> Cancelar
        </button>

        <button type="submit"
          class="bg-blue-600 hover:bg-blue-700 text-white rounded-lg px-8 py-2 text-sm font-semibold shadow transition">
          <i class="fas fa-save mr-2"></i> Salvar Usuário
        </button>
      </div>

    </form>

  </div>
</div>

<!-- ===================== SCRIPTS ===================== -->
<script>
  function abrirModalUsuario() {
    const modal = document.getElementById('modalUsuario');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  function fecharModalUsuario() {
    const modal = document.getElementById('modalUsuario');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  function toggleSenha(id) {
    const input = document.getElementById(id);
    const icon = input.parentElement.querySelector("i");
    if (input.type === "password") {
      input.type = "text";
      icon.classList.replace("fa-eye", "fa-eye-slash");
    } else {
      input.type = "password";
      icon.classList.replace("fa-eye-slash", "fa-eye");
    }
  }
</script>

<style>
  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }
  .animate-fadeIn { animation: fadeIn .25s ease-out forwards; }
</style>

{% endblock %}
